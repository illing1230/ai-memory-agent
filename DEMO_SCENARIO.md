# MemGate 데모 시나리오

## 사전 준비

```bash
# 1. DB 초기화 + 시드 데이터
rm -f data/sqlite/memory.db*
python -m src.scripts.seed_demo

# 2. 데모 문서 자동 생성 (seed_demo에 포함)
#    - 품질검사_매뉴얼.pptx (5 슬라이드)
#    - 프로젝트_가이드.txt

# 3. 서버 실행
python -m uvicorn src.main:app --host 0.0.0.0 --port 8000
```

## 데모 계정

| 이름 | 이메일 | 비밀번호 | 역할 | 팀 |
|------|--------|----------|------|-----|
| hy.joo | admin@test.com | test123 | admin | 개발팀 |
| 김품질 | kim.quality@company.com | test123 | user | 품질팀 |
| 최개발 | choi.dev@company.com | test123 | user | 개발팀 |

> **SSO/Mattermost 로그인**: 이메일 입력 후 "SSO 로그인" 또는 "Mattermost로 로그인" 버튼 클릭 시 해당 사용자로 즉시 로그인됩니다.

---

## 데모 0: 로그인 (1분)

> **목적**: SSO와 Mattermost 로그인 버튼이 분리되어 있는 것을 보여줌

1. 로그인 페이지 접속
2. **"테스트 계정으로 채우기 (hy.joo)"** 클릭 → 이메일/비밀번호 자동 입력
3. **"SSO 로그인"** 버튼 클릭 → hy.joo로 로그인 성공
4. 로그아웃
5. 다시 이메일에 `admin@test.com` 입력 → **"Mattermost로 로그인"** 클릭 → hy.joo로 로그인 성공
6. 두 버튼이 별도 SSO 프로바이더(saml/mattermost)로 동작하는 것을 확인

---

## 데모 1: 대화방 + 메모리 (3분)

> **목적**: 대화방에서 AI와 대화하고, 메모리가 자동 추출/검색되는 것을 보여줌

**로그인**: hy.joo (`admin@test.com` / `test123`)

1. **"개발팀 공유" 대화방** 입장
2. 메시지 전송:
   ```
   @ai 우리 팀 MemGate 프로젝트 3월 릴리즈 일정 알려줘
   ```
   → AI가 시드 메모리("3월 릴리즈 일정이 MemGate 프로젝트의 첫 번째 마일스톤이다")를 참조하여 답변
   → **참조 소스** 패널에 메모리가 표시됨

3. 수동 메모리 저장:
   ```
   /remember 3월 릴리즈 범위: 문서 RAG + PPTX 슬라이드 검색 기능 포함
   ```

4. 메모리 검색:
   ```
   /search 릴리즈 범위
   ```
   → 방금 저장한 메모리가 검색됨

---

## 데모 2: 문서 RAG — TXT + Entity 전략 (4분)

> **목적**: 문서 RAG의 단순 검색과 엔티티 그래프 기반 쿼리 확장의 차이를 보여줌

**로그인**: hy.joo (`admin@test.com` / `test123`)

### 2-1. 단순 문서 RAG

1. **"MemGate 개발 채팅" 대화방** 입장
2. 좌측 **문서 관리** 페이지 이동
3. **프로젝트_가이드.txt** 확인 (시드에 포함됨)
4. 문서 **미리보기** 클릭 → 청크 단위 표시 확인
5. 대화방으로 돌아가서:
   ```
   @ai MemGate 프로젝트의 브랜치 전략이 어떻게 되어 있어?
   ```
   → AI가 문서 내용("main, develop, feature/*, hotfix/*")을 참조하여 답변
   → **참조 소스** 패널에 "프로젝트_가이드.txt" 문서가 표시됨
   → *이것은 단순 벡터 검색 + 키워드 검색의 결과*

### 2-2. Entity 그래프 기반 확장 검색

6. 같은 대화방에서:
   ```
   @ai PLM 시스템이랑 MemGate가 어떤 관계야?
   ```
   → 서버 로그 확인: `문서 검색 쿼리 확장: PLM 시스템이랑 MemGate → PLM 시스템이랑 MemGate PLM 시스템 MemGate 박관리 ...`
   → AI가 **여러 대화방에 흩어진 메모리**를 엔티티 관계로 연결하여 답변:
     - "MemGate의 문서 RAG 기능이 PLM 시스템 품질 매뉴얼 검색에도 활용될 예정" (MemGate 대화방)
     - "박관리가 PLM 시스템 프로젝트를 총괄 관리" (PLM 대화방)
   → **참조 소스**에 메모리 + 문서가 함께 표시됨

> **핵심 포인트**: 단순 RAG는 해당 대화방의 문서만 검색하지만, Entity 전략은 엔티티 그래프를 통해 **다른 대화방의 메모리까지 연결**하여 풍부한 컨텍스트 제공

---

## 데모 3: Entity 그래프 크로스룸 검색 (3분)

> **목적**: 엔티티 관계를 통해 서로 다른 대화방의 정보가 연결되는 것을 시각적으로 보여줌

**로그인**: hy.joo (`admin@test.com` / `test123`) — 품질팀 공유 대화방에도 멤버로 포함되어 크로스룸 검색 시연 가능

### 시드 데이터 구조 설명

```
[PLM 개발 채팅]                          [품질팀 공유]
 ├ 박관리 →MANAGES→ PLM 시스템            ├ 외관검사 기준 변경 (0.3mm)
 ├ 이검사 →WORKS_ON→ PLM 시스템           ├ 김품질 →MANAGES→ A라인 불량률 개선
 ├ 김품질 →ATTENDS→ 품질검사 미팅         │
 ├ 이검사: 외관검사 정확도 95%            │  김품질 →RELATED_TO→ 외관검사
 │                                        │  이검사 →WORKS_ON→ 외관검사
 └ 외관검사 →PART_OF→ PLM 시스템   ←─────┘  외관검사 →PART_OF→ PLM 시스템
```

### 실행

1. **"품질팀 공유" 대화방** 입장
2. 메시지 전송:
   ```
   @ai 이검사가 맡고 있는 업무가 뭐야?
   ```
   → 엔티티 매칭: `이검사`(person) → 관련 엔티티: `PLM 시스템`, `외관검사`
   → **PLM 개발 채팅** 방의 메모리도 연결:
     - "이검사가 PLM 시스템의 테스트 자동화를 담당" (PLM 대화방)
     - "이검사가 외관검사 정확도를 95%까지 올렸다" (PLM 대화방)
   → **품질팀 공유** 방의 메모리도 함께:
     - "외관검사 기준이 변경되어 스크래치 허용 한도가 0.3mm로 강화" (품질팀 공유)

3. 추가 질문:
   ```
   @ai 박관리에 대해 알려줘
   ```
   → 엔티티 `박관리` → 관계: MANAGES→`PLM 시스템`, ATTENDS→`품질검사 미팅`
   → **다른 방에 있는** 메모리까지 그래프로 탐색:
     - "박관리가 PLM 시스템 프로젝트를 총괄 관리" (PLM 대화방)
     - "박관리가 PLM v2.0 업그레이드 일정을 3월 말로 확정" (PLM 대화방)
     - "박관리는 ISO 9001:2015 체크리스트를 사용" (개인 메모리)
   → **참조 소스** 패널에서 소스가 여러 대화방과 개인 메모리에서 온 것을 확인

> **핵심 포인트**: "박관리"를 검색하면 단순 키워드 매칭이 아니라, 엔티티 그래프를 따라가며 관련 프로젝트·미팅·개인 메모까지 연결하여 포괄적인 답변 생성

---

## 데모 4: 문서 RAG — PPTX 슬라이드 (3분)

> **목적**: PPTX 슬라이드가 이미지로 변환되어 검색·표시되는 것을 보여줌

**로그인**: hy.joo (계속 사용)

1. **"품질팀 공유" 대화방** 입장
2. **품질검사_매뉴얼.pptx** 확인 (시드에 포함됨)
3. 문서 **미리보기** 클릭
   → 슬라이드 이미지가 순서대로 표시됨 (슬라이드 1~5)
   → 이미지 클릭 시 새 탭에서 원본 크기로 열림
4. 대화방에서:
   ```
   @ai 검사원 공통 절차를 알려줘
   ```
   → AI가 슬라이드 2 내용을 참조하여 답변
   → **참조 소스**에 슬라이드 썸네일 이미지가 표시됨

5. 추가 질문:
   ```
   @ai 불량 유형 A등급은 어떤 조치를 해야 해?
   ```
   → 슬라이드 4 내용을 참조하여 답변

---

## 데모 5: Agent 시스템 (3분)

> **목적**: 외부 에이전트(봇)가 데이터를 수집하고, 에이전트 메모리가 대화에 활용되는 것을 보여줌

1. **hy.joo 계정** 로그인
2. 좌측 **에이전트** 메뉴 이동
3. 등록된 에이전트 확인:
   - **품질 모니터링 봇** (agent type: 품질 모니터링)
   - **기술문서 분석 봇** (agent type: 문서 분석)
4. **"품질 모니터링 봇"** 상세 확인:
   - API Key 확인
   - 수집된 데이터(Agent Data) 목록 확인
   - 추출된 에이전트 메모리 확인

5. 대화방 **컨텍스트 소스 설정**에서 에이전트 메모리 활성화:
   - 설정 → 에이전트 인스턴스 선택 → "품질 모니터링 봇" 체크

6. 대화방에서:
   ```
   @ai 최근 품질 검사 결과 알려줘
   ```
   → 에이전트가 수집한 메모리("오늘 A라인 불량률 2.3%")를 참조하여 답변

---

## 데모 6: Agent SDK 연동 (3분)

> **목적**: Agent SDK를 통해 외부 시스템에서 프로그래밍 방식으로 메모리를 저장/검색하는 것을 보여줌

### 사전 준비

```bash
# SDK 설치 (아직 안 했다면)
pip install -e ai_memory_agent_sdk/

# 서버가 실행 중이어야 함
```

### 실행

```bash
python -m src.scripts.demo_agent_sdk
```

### 데모 흐름

1. **서버 헬스 체크** → 서버 상태 확인
2. **메모리 저장** (`send_memory`)
   - "A라인 실시간 불량률 3.1%, 전일 대비 0.8% 상승"
   - "B라인 CPK 지수 1.42 (기준: 1.33 이상)"
3. **메모리 검색** (`search_memories`)
   - "불량률" 검색 → 방금 저장한 메모리 반환
4. **메시지 전송** (`send_message`)
   - 품질 경고 알림 메시지 전송
5. **로그 전송** (`send_log`)
   - 작업 완료 로그 전송
6. **에이전트 데이터 조회** (`get_agent_data`)
   - 저장된 전체 데이터 확인
7. **메모리 소스 조회** (`get_memory_sources`)
   - 접근 가능한 대화방/문서 소스 확인

> **핵심 포인트**: SDK를 통해 외부 시스템(품질 모니터링, 문서 분석 등)이 MemGate에 데이터를 자동으로 저장하고, 저장된 데이터가 대화방에서 AI 답변의 컨텍스트로 활용됨

---

## 데모 7: Mchat(Mattermost) 연동 (2분)

> **목적**: Mattermost 채널과 연동하여 외부 메시지를 동기화하는 것을 보여줌

1. **hy.joo 계정** → 관리자 대시보드
2. **Mchat 설정** 메뉴 확인:
   - 연결 상태 표시 (connected/disconnected)
   - 매핑된 채널 목록
   - 매핑된 사용자 목록
3. 채널 매핑 확인:
   - Mchat `#품질관리` 채널 ↔ MemGate "품질팀 공유" 대화방
4. 사용자 매핑 확인:
   - Mchat `kim.quality` ↔ MemGate `김품질`
5. 대화 요약 로그:
   - 자동 생성된 채널 대화 요약 내역 확인

---

## 데모 흐름 요약

```
0. 로그인                   →  SSO / Mattermost 버튼 분리 확인
1. 대화방 + 메모리          →  AI 대화, /remember, /search
2. RAG (TXT) + Entity      →  문서 검색 + 엔티티 그래프 쿼리 확장 비교
3. Entity 크로스룸 검색     →  엔티티 관계로 다른 대화방 메모리 연결
4. RAG (PPTX)              →  슬라이드 이미지 표시, 슬라이드 기반 답변
5. Agent                   →  외부 봇 연동, 에이전트 메모리 활용
6. Agent SDK               →  SDK로 메모리 저장/검색 자동화
7. Mchat                   →  Mattermost 채널 동기화
```

### Entity 전략 요약 (데모 2, 3의 핵심)

```
[검색 흐름]
사용자 질문: "이검사가 맡고 있는 업무가 뭐야?"
     │
     ▼
1. 엔티티 매칭: "이검사" → Entity(이검사, person)
     │
     ▼
2. 관련 엔티티 탐색 (1-hop):
   이검사 →WORKS_ON→ PLM 시스템
   이검사 →WORKS_ON→ 외관검사
     │
     ▼
3. 쿼리 확장: "이검사가 맡고 있는 업무" → "이검사 PLM 시스템 외관검사"
     │
     ▼
4. 확장된 쿼리로 벡터 + 키워드 하이브리드 검색
     │
     ▼
5. 크로스룸 메모리 검색 (엔티티 그래프):
   - PLM 대화방: "이검사가 테스트 자동화 담당" (직접 연결, score 0.5)
   - PLM 대화방: "외관검사 정확도 95%" (직접 연결, score 0.5)
   - 품질팀 공유: "외관검사 기준 변경 0.3mm" (2-hop, score 0.4)
     │
     ▼
6. Reranker → 최종 결과
```

총 소요 시간: **약 22분**
